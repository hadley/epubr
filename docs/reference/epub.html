<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html>
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Extract and read EPUB e-books — epub • epubr</title>

<!-- jquery -->
<script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<!-- Font Awesome icons -->
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script>

<!-- sticky kit -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>



  <link href="../extra.css" rel="stylesheet">
  
<meta property="og:title" content="Extract and read EPUB e-books — epub" />

<meta property="og:description" content="Read EPUB format e-books into a data frame using epub or extract epub archive files for direct use with epub_unzip." />
<meta name="twitter:card" content="summary" />



<!-- mathjax -->
<script src='https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-46129458-3"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-46129458-3');
</script>

  </head>

  <body>
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">epubr</a>
        <span class="label label-default" data-toggle="tooltip" data-placement="bottom" title="Released package">0.4.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/epubr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Online
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="https://github.com/leonawicz">
        <span class="fa fa-github fa-lg"></span>
         
        GitHub
      </a>
    </li>
    <li>
      <a href="https://twitter.com/leonawicz">
        <span class="fa fa-twitter fa-lg"></span>
         
        Twitter
      </a>
    </li>
    <li>
      <a href="https://www.linkedin.com/in/leonawicz">
        <span class="fa fa-linkedin fa-lg"></span>
         
        LinkedIn
      </a>
    </li>
    <li>
      <a href="https://www.youtube.com/user/StatisticsWithR">
        <span class="fa fa-youtube fa-lg"></span>
         
        YouTube
      </a>
    </li>
    <li>
      <a href="https://plus.google.com/+StatisticsWithR/posts">
        <span class="fa fa-google-plus fa-lg"></span>
         
        Google+
      </a>
    </li>
    <li>
      <a href="https://leonawicz.github.io/blog/">
        <span class="fa fa-pencil-square-o fa-lg"></span>
         
        Blog
      </a>
    </li>
  </ul>
</li>
<li>
  <a href="https://github.com/ropensci/epubr">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      
      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Extract and read EPUB e-books</h1>
    <small class="dont-index">Source: <a href='https://github.com/ropensci/epubr/blob/master/R/epub.R'><code>R/epub.R</code></a></small>
    <div class="hidden name"><code>epub.Rd</code></div>
    </div>

    <div class="ref-description">
    
    <p>Read EPUB format e-books into a data frame using <code>epub</code> or extract epub archive files for direct use with <code>epub_unzip</code>.</p>
    
    </div>

    <pre class="usage"><span class='fu'>epub</span>(<span class='no'>file</span>, <span class='kw'>fields</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='kw'>drop_sections</span> <span class='kw'>=</span> <span class='kw'>NULL</span>,
  <span class='kw'>chapter_pattern</span> <span class='kw'>=</span> <span class='kw'>NULL</span>, <span class='no'>...</span>)

<span class='fu'>epub_meta</span>(<span class='no'>file</span>)

<span class='fu'>epub_unzip</span>(<span class='no'>file</span>, <span class='kw'>exdir</span> <span class='kw'>=</span> <span class='fu'>tempdir</span>())</pre>
    
    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>file</th>
      <td><p>character, input EPUB filename. May be a vector for <code>epub</code> and <code>epub_meta</code>. Always a single file for <code>epub_unzip</code>.</p></td>
    </tr>
    <tr>
      <th>fields</th>
      <td><p>character, vector of metadata fields (data frame columns) to parse from metadata, if they exist. See details.</p></td>
    </tr>
    <tr>
      <th>drop_sections</th>
      <td><p>character, a regular expression pattern string to identify text sections (rows of nested text data frame) to drop.</p></td>
    </tr>
    <tr>
      <th>chapter_pattern</th>
      <td><p>character, a regular expression pattern string to attempt distinguishing nested data frame rows of chapter text entries from other types of entries.</p></td>
    </tr>
    <tr>
      <th>...</th>
      <td><p>additional arguments. With the exception of passing <code>title</code> (see details), currently developmental/unsupported.</p></td>
    </tr>
    <tr>
      <th>exdir</th>
      <td><p>character, extraction directory to place archive contents (files).</p></td>
    </tr>
    </table>
    
    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p><code>epub</code> returns a data frame. <code>epub_unzip</code> returns nothing but extracts files from an epub file archive.</p>
    
    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    <p>The primary function here is <code>epub</code>. It parses EPUB file metadata and textual content into a data frame.
The output data frame has one row for each file in <code>file</code>.
It has metadata in all columns except the <code>data</code> column, which is a column of nested data frames containing e-book text by book section (e.g., chapters).
Both the primary and nested data frames are tibbles and safe to print to the console "as is".</p>
<p>Be careful if <code>file</code> is a long vector of many EPUB files.
This could take a long time to process as well as could potentially use up all of your system RAM if you have far too many large books in one call to <code>epub</code>.</p>
<p>On a case by case basis, you can always select columns and filter rows of a resulting data frame for a single e-book subsequent to visual inspection.
However, the optional arguments <code>fields</code>, <code>drop_sections</code> and <code>chapter_pattern</code> allow you to do some of this as part of the EPUB file reading process.
You can ignore these arguments and do all your own post-processing of the resulting data frame, but if using these arguments,
they are most likely to be useful for bulk e-book processing where <code>file</code> is a vector of like-formatted files.</p>
<h3>Main columns</h3>
    The <code>fields</code> argument can be used to limit the columns returned in the primary data frame.
E.g., <code>fields = c("title", "creator", "date", "identifier", "publisher", "file")</code>. Some fields will be returned even if not in <code>fields</code>, such as <code>data</code> and <code>title</code>.
<br /><br />
Ideally, you should already know what metadata fields are in the EPUB file. This is not possible for large collections with possibly different formatting.
Note that when <code>"file"</code> is included in <code>fields</code>, the output will include a column of the original file names, in case this is different from the content of a <code>source</code> field that may be present in the metadata.
So this field is always available even if not part of the file metadata.
<br /><br />
Additionally, if there is no <code>title</code> field in the metadata, the output data frame will include a <code>title</code> column filled in with the same file names,
unless you pass the additional optional title argument, e.g. <code>title = "TitleFieldID"</code> so that another field can me mapped to <code>title</code>.
If supplying a <code>title</code> argument that also does not match an existing field in the e-book, the output <code>title</code> column will again default to file names.
File names are the fallback option because unlike e-book metadata fields, file names always exist and should also always be unique when performing vectorized reads over multiple books,
ensuring that <code>title</code> can be a column in the output data frame that uniquely identifies different e-books even if the books did not have a <code>title</code> field in their metadata.
<br /><br />
Columns of the nested data frames in <code>data</code> are fixed. Select from these in subsequent data frame manipulations.
    <h3>Nested rows</h3>
    The <code>chapter_pattern</code> argument may be helpful for bulk processing of similarly formatted EPUB files. This should be ignored for poorly formatted EPUB files or where there is inconsistent naming across an e-book collection.
Like with <code>fields</code>, you should explore file metadata in advance or this argument will not be useful. If provided, a column <code>nchap</code> is added to the output data frame giving the guessed number of chapters.
In the <code>data</code> column, the <code>section</code> column of the nested data frames will also be updated to reflect guessed chapters with new, consistent chapter IDs, always beginning with <code>ch</code> and ending with digits.
<br /><br />
The <code>drop_sections</code> argument also uses regular expression pattern matching like <code>chapter_pattern</code> and operates on the same <code>section</code> column. It simply filters out any matched rows.
This is useful for dropping rows that may pertain to book cover, copyright and acknowledgements pages, and other similar, clearly non-chapter text, e-book sections.
An example that might work for many books could be <code>drop_sections = "^co(v|p)|^ack"</code>
<br /><br />
Rows of the primary data frame are fixed. Filter or otherwise manipulate these in subsequent data frame manipulations. There is one row per file so filtering does not make sense to do as part of the initial file reading.
    <h3>EPUB metadata</h3>
    Use <code>epub_meta</code> to return a data frame of only the metadata for each file in <code>file</code>. This skips the reading of each file's text contents, strictly parsing the metadata.
It returns a data frame with one row for each file and <code>n</code> columns where <code>n</code> is equal to the union of all fields identified across all files in <code>file</code>.
Fields available for at least one e-book in <code>file</code> will return <code>NA</code> in that column for any row pertaining to an e-book that does not have that field in its metadata.
    <h3>Unzipping EPUB files</h3>
    If using <code>epub_unzip</code> directly on individual EPUB files, this gives you control over where to extract archive files to and what to do with them subsequently.
<code>epub</code> and <code>epub_meta</code> use <code>epub_unzip</code> internally to extract EPUB archive files to the R session temp directory (with <code>tempdir()</code>).
You do not need to use <code>epub_unzip</code> directly prior to using these other functions. It is only needed if you want the internal files for some other purpose in or out of R.
    

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># Use a local example epub file included in the package</span>
<span class='no'>file</span> <span class='kw'>&lt;-</span> <span class='fu'>system.file</span>(<span class='st'>"dracula.epub"</span>, <span class='kw'>package</span> <span class='kw'>=</span> <span class='st'>"epubr"</span>)
<span class='no'>bookdir</span> <span class='kw'>&lt;-</span> <span class='fu'>file.path</span>(<span class='fu'>tempdir</span>(), <span class='st'>"dracula"</span>)
<span class='fu'>epub_unzip</span>(<span class='no'>file</span>, <span class='kw'>exdir</span> <span class='kw'>=</span> <span class='no'>bookdir</span>) <span class='co'># unzip to directly inspect archive files</span>
<span class='fu'>list.files</span>(<span class='no'>bookdir</span>, <span class='kw'>recursive</span> <span class='kw'>=</span> <span class='fl'>TRUE</span>)</div><div class='output co'>#&gt;  [1] "META-INF/container.xml"                                                  
#&gt;  [2] "mimetype"                                                                
#&gt;  [3] "OEBPS/@public@vhost@g@gutenberg@html@files@345@345-h@345-h-0.htm.html"   
#&gt;  [4] "OEBPS/@public@vhost@g@gutenberg@html@files@345@345-h@345-h-1.htm.html"   
#&gt;  [5] "OEBPS/@public@vhost@g@gutenberg@html@files@345@345-h@345-h-10.htm.html"  
#&gt;  [6] "OEBPS/@public@vhost@g@gutenberg@html@files@345@345-h@345-h-11.htm.html"  
#&gt;  [7] "OEBPS/@public@vhost@g@gutenberg@html@files@345@345-h@345-h-12.htm.html"  
#&gt;  [8] "OEBPS/@public@vhost@g@gutenberg@html@files@345@345-h@345-h-13.htm.html"  
#&gt;  [9] "OEBPS/@public@vhost@g@gutenberg@html@files@345@345-h@345-h-2.htm.html"   
#&gt; [10] "OEBPS/@public@vhost@g@gutenberg@html@files@345@345-h@345-h-3.htm.html"   
#&gt; [11] "OEBPS/@public@vhost@g@gutenberg@html@files@345@345-h@345-h-4.htm.html"   
#&gt; [12] "OEBPS/@public@vhost@g@gutenberg@html@files@345@345-h@345-h-5.htm.html"   
#&gt; [13] "OEBPS/@public@vhost@g@gutenberg@html@files@345@345-h@345-h-6.htm.html"   
#&gt; [14] "OEBPS/@public@vhost@g@gutenberg@html@files@345@345-h@345-h-7.htm.html"   
#&gt; [15] "OEBPS/@public@vhost@g@gutenberg@html@files@345@345-h@345-h-8.htm.html"   
#&gt; [16] "OEBPS/@public@vhost@g@gutenberg@html@files@345@345-h@345-h-9.htm.html"   
#&gt; [17] "OEBPS/@public@vhost@g@gutenberg@html@files@345@345-h@images@colophon.png"
#&gt; [18] "OEBPS/@public@vhost@g@gutenberg@html@files@345@345-h@images@cover.jpg"   
#&gt; [19] "OEBPS/0.css"                                                             
#&gt; [20] "OEBPS/1.css"                                                             
#&gt; [21] "OEBPS/content.opf"                                                       
#&gt; [22] "OEBPS/pgepub.css"                                                        
#&gt; [23] "OEBPS/toc.ncx"                                                           
#&gt; [24] "OEBPS/wrap0000.html"                                                     </div><div class='input'>
<span class='fu'>epub_meta</span>(<span class='no'>file</span>) <span class='co'># parse EPUB file metadata only</span></div><div class='output co'>#&gt; # A tibble: 1 x 8
#&gt;   rights    identifier     creator  title  language subject  date  source      
#&gt;   &lt;chr&gt;     &lt;chr&gt;          &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;       
#&gt; 1 Public d~ http://www.gu~ Bram St~ Dracu~ en       Horror ~ 1995~ http://www.~</div><div class='input'>
<span class='no'>x</span> <span class='kw'>&lt;-</span> <span class='fu'>epub</span>(<span class='no'>file</span>) <span class='co'># parse entire e-book</span>
<span class='no'>x</span></div><div class='output co'>#&gt; # A tibble: 1 x 9
#&gt;   rights   identifier    creator  title language subject date  source    data  
#&gt;   &lt;chr&gt;    &lt;chr&gt;         &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;     &lt;list&gt;
#&gt; 1 Public ~ http://www.g~ Bram St~ Drac~ en       Horror~ 1995~ http://w~ &lt;tibb~</div><div class='input'><span class='no'>x</span>$<span class='no'>data</span><span class='kw'>[[</span><span class='fl'>1</span>]]</div><div class='output co'>#&gt; # A tibble: 15 x 4
#&gt;    section        text                                              nword nchar
#&gt;    &lt;chr&gt;          &lt;chr&gt;                                             &lt;int&gt; &lt;int&gt;
#&gt;  1 item6          "The Project Gutenberg EBook of Dracula, by Bram~ 11252 60972
#&gt;  2 item7          "But I am not in heart to describe beauty, for w~ 13740 71798
#&gt;  3 item8          "“ ‘Lucy, you are an honest-hearted girl, I know~ 12356 65522
#&gt;  4 item9          "CHAPTER VIIIMINA MURRAY’S JOURNAL\nSame day, 11~ 12042 62724
#&gt;  5 item10         "CHAPTER X\nLetter, Dr. Seward to Hon. Arthur Ho~ 12599 66678
#&gt;  6 item11         "Once again we went through that ghastly operati~ 11919 62949
#&gt;  7 item12         "CHAPTER XIVMINA HARKER’S JOURNAL\n23 September.~ 12003 62234
#&gt;  8 item13         "CHAPTER XVIDR. SEWARD’S DIARY—continued\nIT was~ 13812 72903
#&gt;  9 item14         "“Thus when we find the habitation of this man-t~ 13201 69779
#&gt; 10 item15         "“I see,” I said. “You want big things that you ~ 12706 66921
#&gt; 11 item16         "CHAPTER XXIIIDR. SEWARD’S DIARY\n3 October.—The~ 11818 61550
#&gt; 12 item17         "CHAPTER XXVDR. SEWARD’S DIARY\n11 October, Even~ 12989 68564
#&gt; 13 item18         " \nLater.—Dr. Van Helsing has returned. He has ~  8356 43464
#&gt; 14 item19         "End of the Project Gutenberg EBook of Dracula, ~  2669 18541
#&gt; 15 coverpage-wra~ ""                                                    0     0</div><div class='input'>
<span class='fu'>epub</span>(<span class='no'>file</span>, <span class='kw'>fields</span> <span class='kw'>=</span> <span class='fu'>c</span>(<span class='st'>"title"</span>, <span class='st'>"creator"</span>), <span class='kw'>drop_sections</span> <span class='kw'>=</span> <span class='st'>"^cov"</span>)</div><div class='output co'>#&gt; # A tibble: 1 x 3
#&gt;   title   creator     data             
#&gt;   &lt;chr&gt;   &lt;chr&gt;       &lt;list&gt;           
#&gt; 1 Dracula Bram Stoker &lt;tibble [14 x 4]&gt;</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
    <h2>Contents</h2>
    <ul class="nav nav-pills nav-stacked">
      <li><a href="#arguments">Arguments</a></li>
      
      <li><a href="#value">Value</a></li>

      <li><a href="#details">Details</a></li>
      
      <li><a href="#examples">Examples</a></li>
    </ul>

  </div>
</div>

      <footer>
      <div class="copyright">
  <p>Developed by <a href='http://leonawicz.github.io/'>Matthew Leonawicz</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
   </div>

  

  </body>
</html>

